openapi: 3.1.0
info:
  title: タスク管理API
  description: |
    チームでのタスク管理を効率化するためのRESTful API。
    プロジェクト単位でタスクを管理し、コメント機能でコミュニケーションが可能。
    
    ## 認証
    
    本APIはJWT Bearer認証を使用します。
    `Authorization: Bearer {token}` ヘッダーを付与してください。
    
    - Access Token 有効期限: 1時間
    - Refresh Token 有効期限: 7日
    
    ## エラーレスポンス
    
    エラー時は以下の形式でレスポンスを返却します。
    
    ```json
    {
      "error": {
        "code": "ERROR_CODE",
        "message": "エラーメッセージ",
        "details": [],
        "requestId": "uuid"
      }
    }
    ```
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000/api/v1
    description: 開発環境
  - url: https://staging-api.example.com/api/v1
    description: ステージング環境
  - url: http://task-management-api-alb-381160588.us-east-1.elb.amazonaws.com/api/v1
    description: 本番環境

tags:
  - name: auth
    description: 認証関連
  - name: projects
    description: プロジェクト管理
  - name: tasks
    description: タスク管理
  - name: comments
    description: コメント管理

paths:
  # ============================================
  # 認証 API
  # ============================================
  /auth/register:
    post:
      tags:
        - auth
      summary: ユーザー登録
      description: 新規ユーザーアカウントを作成します
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
            example:
              email: user@example.com
              password: Password123
              name: 山田太郎
      responses:
        "201":
          description: 登録成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "409":
          $ref: "#/components/responses/Conflict"
        "422":
          $ref: "#/components/responses/ValidationError"

  /auth/login:
    post:
      tags:
        - auth
      summary: ログイン
      description: メールアドレスとパスワードで認証し、JWTトークンを取得します
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
            example:
              email: user@example.com
              password: Password123
      responses:
        "200":
          description: 認証成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"

  /auth/refresh:
    post:
      tags:
        - auth
      summary: トークンリフレッシュ
      description: リフレッシュトークンを使用して新しいアクセストークンを取得します
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenRequest"
      responses:
        "200":
          description: トークン更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /auth/logout:
    post:
      tags:
        - auth
      summary: ログアウト
      description: 現在のセッションを無効化します
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        "204":
          description: ログアウト成功
        "401":
          $ref: "#/components/responses/Unauthorized"

  # ============================================
  # プロジェクト API
  # ============================================
  /projects:
    get:
      tags:
        - projects
      summary: プロジェクト一覧取得
      description: ユーザーが参加しているプロジェクトの一覧を取得します
      operationId: listProjects
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
        - $ref: "#/components/parameters/SortParam"
        - $ref: "#/components/parameters/OrderParam"
      responses:
        "200":
          description: 取得成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

    post:
      tags:
        - projects
      summary: プロジェクト作成
      description: 新しいプロジェクトを作成します。作成者がオーナーになります。
      operationId: createProject
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateProjectRequest"
            example:
              name: 新規プロジェクト
              description: プロジェクトの説明文
      responses:
        "201":
          description: 作成成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          $ref: "#/components/responses/ValidationError"

  /projects/{projectId}:
    get:
      tags:
        - projects
      summary: プロジェクト詳細取得
      description: 指定したプロジェクトの詳細を取得します
      operationId: getProject
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectIdParam"
      responses:
        "200":
          description: 取得成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectDetailResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      tags:
        - projects
      summary: プロジェクト更新
      description: プロジェクト情報を更新します（オーナーのみ）
      operationId: updateProject
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProjectRequest"
      responses:
        "200":
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/ValidationError"

    delete:
      tags:
        - projects
      summary: プロジェクト削除
      description: プロジェクトを削除します（オーナーのみ）。関連するタスク・コメントも削除されます。
      operationId: deleteProject
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectIdParam"
      responses:
        "204":
          description: 削除成功
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /projects/{projectId}/members:
    get:
      tags:
        - projects
      summary: プロジェクトメンバー一覧
      description: プロジェクトのメンバー一覧を取得します
      operationId: listProjectMembers
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectIdParam"
      responses:
        "200":
          description: 取得成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectMemberListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    post:
      tags:
        - projects
      summary: メンバー追加
      description: プロジェクトにメンバーを追加します（オーナーのみ）
      operationId: addProjectMember
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddMemberRequest"
      responses:
        "201":
          description: 追加成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectMemberResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /projects/{projectId}/members/{userId}:
    delete:
      tags:
        - projects
      summary: メンバー削除
      description: プロジェクトからメンバーを削除します（オーナーのみ）
      operationId: removeProjectMember
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectIdParam"
        - $ref: "#/components/parameters/UserIdParam"
      responses:
        "204":
          description: 削除成功
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  # ============================================
  # タスク API
  # ============================================
  /projects/{projectId}/tasks:
    get:
      tags:
        - tasks
      summary: タスク一覧取得
      description: プロジェクト内のタスク一覧を取得します
      operationId: listTasks
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectIdParam"
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
        - $ref: "#/components/parameters/SortParam"
        - $ref: "#/components/parameters/OrderParam"
        - name: status
          in: query
          description: ステータスでフィルタリング
          schema:
            type: string
            enum:
              - todo
              - in_progress
              - done
        - name: priority
          in: query
          description: 優先度でフィルタリング
          schema:
            type: string
            enum:
              - low
              - medium
              - high
        - name: assigneeId
          in: query
          description: 担当者IDでフィルタリング
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: 取得成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    post:
      tags:
        - tasks
      summary: タスク作成
      description: プロジェクト内に新しいタスクを作成します
      operationId: createTask
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/ProjectIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTaskRequest"
            example:
              title: 新規タスク
              description: タスクの詳細説明
              status: todo
              priority: high
              dueDate: "2024-12-31T23:59:59Z"
              assigneeId: 770e8400-e29b-41d4-a716-446655440000
      responses:
        "201":
          description: 作成成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/ValidationError"

  /tasks/{taskId}:
    get:
      tags:
        - tasks
      summary: タスク詳細取得
      description: タスクの詳細を取得します
      operationId: getTask
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/TaskIdParam"
      responses:
        "200":
          description: 取得成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskDetailResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    put:
      tags:
        - tasks
      summary: タスク更新
      description: タスク情報を更新します
      operationId: updateTask
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/TaskIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateTaskRequest"
      responses:
        "200":
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/ValidationError"

    delete:
      tags:
        - tasks
      summary: タスク削除
      description: タスクを削除します（オーナー/adminのみ）。関連するコメントも削除されます。
      operationId: deleteTask
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/TaskIdParam"
      responses:
        "204":
          description: 削除成功
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  # ============================================
  # コメント API
  # ============================================
  /tasks/{taskId}/comments:
    get:
      tags:
        - comments
      summary: コメント一覧取得
      description: タスクのコメント一覧を取得します
      operationId: listComments
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/TaskIdParam"
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/LimitParam"
      responses:
        "200":
          description: 取得成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CommentListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    post:
      tags:
        - comments
      summary: コメント作成
      description: タスクにコメントを追加します
      operationId: createComment
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/TaskIdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCommentRequest"
            example:
              content: コメント内容です
      responses:
        "201":
          description: 作成成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CommentResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/ValidationError"

  /comments/{commentId}:
    delete:
      tags:
        - comments
      summary: コメント削除
      description: コメントを削除します（作成者またはオーナー/admin）
      operationId: deleteComment
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/CommentIdParam"
      responses:
        "204":
          description: 削除成功
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

components:
  # ============================================
  # セキュリティスキーム
  # ============================================
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT認証トークン

  # ============================================
  # パラメータ
  # ============================================
  parameters:
    ProjectIdParam:
      name: projectId
      in: path
      required: true
      description: プロジェクトID
      schema:
        type: string
        format: uuid
        example: 550e8400-e29b-41d4-a716-446655440000

    TaskIdParam:
      name: taskId
      in: path
      required: true
      description: タスクID
      schema:
        type: string
        format: uuid
        example: 880e8400-e29b-41d4-a716-446655440000

    CommentIdParam:
      name: commentId
      in: path
      required: true
      description: コメントID
      schema:
        type: string
        format: uuid
        example: 990e8400-e29b-41d4-a716-446655440000

    UserIdParam:
      name: userId
      in: path
      required: true
      description: ユーザーID
      schema:
        type: string
        format: uuid
        example: 660e8400-e29b-41d4-a716-446655440000

    PageParam:
      name: page
      in: query
      description: ページ番号（1始まり）
      schema:
        type: integer
        minimum: 1
        default: 1
        example: 1

    LimitParam:
      name: limit
      in: query
      description: 1ページあたりの取得件数
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
        example: 20

    SortParam:
      name: sort
      in: query
      description: ソートフィールド
      schema:
        type: string
        default: createdAt
        example: createdAt

    OrderParam:
      name: order
      in: query
      description: ソート順
      schema:
        type: string
        enum:
          - asc
          - desc
        default: desc
        example: desc

  # ============================================
  # スキーマ
  # ============================================
  schemas:
    # --- 認証 ---
    RegisterRequest:
      type: object
      required:
        - email
        - password
        - name
      properties:
        email:
          type: string
          format: email
          maxLength: 255
          description: メールアドレス
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          description: パスワード（8文字以上、英数字混合）
          example: Password123
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: ユーザー名
          example: 山田太郎

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: メールアドレス
          example: user@example.com
        password:
          type: string
          format: password
          description: パスワード
          example: Password123

    RefreshTokenRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          description: リフレッシュトークン
          example: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...

    TokenResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            accessToken:
              type: string
              description: アクセストークン
              example: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
            refreshToken:
              type: string
              description: リフレッシュトークン
              example: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
            expiresIn:
              type: integer
              description: 有効期限（秒）
              example: 3600
            tokenType:
              type: string
              description: トークンタイプ
              example: Bearer

    # --- ユーザー ---
    UserSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 660e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          example: 山田太郎

    UserDetail:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 660e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          example: 山田太郎
        email:
          type: string
          format: email
          example: yamada@example.com

    UserResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
              example: 660e8400-e29b-41d4-a716-446655440000
            email:
              type: string
              format: email
              example: user@example.com
            name:
              type: string
              example: 山田太郎
            createdAt:
              type: string
              format: date-time
              example: "2024-12-29T10:00:00Z"

    # --- プロジェクト ---
    CreateProjectRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: プロジェクト名
          example: 新規プロジェクト
        description:
          type: string
          maxLength: 1000
          description: 説明
          example: プロジェクトの説明文

    UpdateProjectRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: プロジェクト名
          example: 更新後のプロジェクト名
        description:
          type: string
          maxLength: 1000
          description: 説明
          example: 更新後の説明

    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
          example: 550e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          example: プロジェクトA
        description:
          type: string
          example: プロジェクトの説明
        owner:
          $ref: "#/components/schemas/UserSummary"
        role:
          type: string
          enum:
            - owner
            - admin
            - member
          example: owner
        taskCount:
          type: integer
          example: 15
        createdAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-12-29T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-12-29T10:00:00Z"

    ProjectResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/Project"

    ProjectListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Project"
        pagination:
          $ref: "#/components/schemas/Pagination"

    ProjectDetailResponse:
      type: object
      properties:
        data:
          type: object
          allOf:
            - $ref: "#/components/schemas/Project"
            - type: object
              properties:
                members:
                  type: array
                  items:
                    $ref: "#/components/schemas/ProjectMember"
                taskSummary:
                  type: object
                  properties:
                    total:
                      type: integer
                      example: 20
                    todo:
                      type: integer
                      example: 10
                    inProgress:
                      type: integer
                      example: 5
                    done:
                      type: integer
                      example: 5

    # --- プロジェクトメンバー ---
    AddMemberRequest:
      type: object
      required:
        - userId
      properties:
        userId:
          type: string
          format: uuid
          description: 追加するユーザーID
          example: 770e8400-e29b-41d4-a716-446655440000
        role:
          type: string
          enum:
            - admin
            - member
          default: member
          description: ロール
          example: member

    ProjectMember:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 770e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          example: 鈴木花子
        email:
          type: string
          format: email
          example: suzuki@example.com
        role:
          type: string
          enum:
            - owner
            - admin
            - member
          example: member

    ProjectMemberResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/ProjectMember"

    ProjectMemberListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/ProjectMember"

    # --- タスク ---
    CreateTaskRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 100
          description: タイトル
          example: 新規タスク
        description:
          type: string
          maxLength: 1000
          description: 説明
          example: タスクの詳細説明
        status:
          type: string
          enum:
            - todo
            - in_progress
            - done
          default: todo
          description: ステータス
          example: todo
        priority:
          type: string
          enum:
            - low
            - medium
            - high
          default: medium
          description: 優先度
          example: high
        dueDate:
          type: string
          format: date-time
          description: 期限
          example: "2024-12-31T23:59:59Z"
        assigneeId:
          type: string
          format: uuid
          description: 担当者ID
          example: 770e8400-e29b-41d4-a716-446655440000

    UpdateTaskRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 100
          description: タイトル
          example: 更新後のタイトル
        description:
          type: string
          maxLength: 1000
          description: 説明
          example: 更新後の説明
        status:
          type: string
          enum:
            - todo
            - in_progress
            - done
          description: ステータス
          example: in_progress
        priority:
          type: string
          enum:
            - low
            - medium
            - high
          description: 優先度
          example: medium
        dueDate:
          type: string
          format: date-time
          description: 期限
          example: "2025-01-15T23:59:59Z"
        assigneeId:
          type: string
          format: uuid
          description: 担当者ID
          example: 770e8400-e29b-41d4-a716-446655440000

    Task:
      type: object
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
          example: 880e8400-e29b-41d4-a716-446655440000
        title:
          type: string
          example: タスク1
        description:
          type: string
          example: タスクの説明
        status:
          type: string
          enum:
            - todo
            - in_progress
            - done
          example: todo
        priority:
          type: string
          enum:
            - low
            - medium
            - high
          example: high
        dueDate:
          type: string
          format: date-time
          example: "2024-12-31T23:59:59Z"
        assignee:
          $ref: "#/components/schemas/UserSummary"
        commentCount:
          type: integer
          example: 3
        createdAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-12-29T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-12-29T10:00:00Z"

    TaskResponse:
      type: object
      properties:
        data:
          allOf:
            - $ref: "#/components/schemas/Task"
            - type: object
              properties:
                project:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                      example: 550e8400-e29b-41d4-a716-446655440000
                    name:
                      type: string
                      example: プロジェクトA

    TaskListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Task"
        pagination:
          $ref: "#/components/schemas/Pagination"

    TaskDetailResponse:
      type: object
      properties:
        data:
          allOf:
            - $ref: "#/components/schemas/Task"
            - type: object
              properties:
                project:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                      example: 550e8400-e29b-41d4-a716-446655440000
                    name:
                      type: string
                      example: プロジェクトA
                comments:
                  type: array
                  items:
                    $ref: "#/components/schemas/Comment"

    # --- コメント ---
    CreateCommentRequest:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          minLength: 1
          maxLength: 1000
          description: コメント内容
          example: コメント内容です

    Comment:
      type: object
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
          example: 990e8400-e29b-41d4-a716-446655440000
        content:
          type: string
          example: コメント内容です
        user:
          $ref: "#/components/schemas/UserSummary"
        createdAt:
          type: string
          format: date-time
          readOnly: true
          example: "2024-12-29T11:00:00Z"

    CommentResponse:
      type: object
      properties:
        data:
          allOf:
            - $ref: "#/components/schemas/Comment"
            - type: object
              properties:
                task:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                      example: 880e8400-e29b-41d4-a716-446655440000
                    title:
                      type: string
                      example: タスク1

    CommentListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Comment"
        pagination:
          $ref: "#/components/schemas/Pagination"

    # --- 共通 ---
    Pagination:
      type: object
      properties:
        currentPage:
          type: integer
          description: 現在のページ
          example: 1
        totalPages:
          type: integer
          description: 総ページ数
          example: 10
        totalItems:
          type: integer
          description: 総件数
          example: 200
        itemsPerPage:
          type: integer
          description: 1ページあたりの件数
          example: 20
        hasNext:
          type: boolean
          description: 次ページの有無
          example: true
        hasPrev:
          type: boolean
          description: 前ページの有無
          example: false

    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: string
              description: エラーコード
              example: VAL_001
            message:
              type: string
              description: エラーメッセージ
              example: バリデーションエラーが発生しました
            details:
              type: array
              items:
                type: object
                properties:
                  field:
                    type: string
                    description: エラーが発生したフィールド
                    example: email
                  reason:
                    type: string
                    description: エラー理由
                    example: format
                  message:
                    type: string
                    description: 詳細メッセージ
                    example: 有効なメールアドレスを入力してください
            requestId:
              type: string
              format: uuid
              description: リクエストID
              example: 550e8400-e29b-41d4-a716-446655440000

  # ============================================
  # レスポンス
  # ============================================
  responses:
    BadRequest:
      description: リクエスト不正
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            error:
              code: BAD_REQUEST
              message: リクエストの形式が正しくありません
              requestId: 550e8400-e29b-41d4-a716-446655440000

    Unauthorized:
      description: 認証エラー
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            error:
              code: AUTH_001
              message: 認証に失敗しました
              requestId: 550e8400-e29b-41d4-a716-446655440000

    Forbidden:
      description: 認可エラー
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            error:
              code: AUTHZ_001
              message: このリソースへのアクセス権限がありません
              requestId: 550e8400-e29b-41d4-a716-446655440000

    NotFound:
      description: リソース未存在
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            error:
              code: RES_001
              message: リソースが見つかりません
              requestId: 550e8400-e29b-41d4-a716-446655440000

    Conflict:
      description: 競合エラー
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            error:
              code: RES_002
              message: リソースが既に存在するか、競合が発生しました
              requestId: 550e8400-e29b-41d4-a716-446655440000

    ValidationError:
      description: バリデーションエラー
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            error:
              code: VAL_001
              message: 入力値に誤りがあります
              details:
                - field: email
                  reason: format
                  message: 有効なメールアドレスを入力してください
              requestId: 550e8400-e29b-41d4-a716-446655440000
